<%= render partial: 'tournaments/edit'%>
<%= render partial: 'tournaments/delete'%>
<%= render partial: 'tournaments/email'%>
<%= render partial: 'sponsor/new'%>
<%= render partial: 'organizer/new'%>
<%= render partial: 'players/new'%>
<%= render partial: 'sponsorships/new'%>
<%= render partial: 'tournaments/edit_datetime' %>
<%= render partial: 'scheduled_events/new' %>
<%= render partial: 'unscheduled_events/new' %>

<div class="container">

	<div class="row">
  	<div class = "col-md-12">
		 <div class="alert alert-warning" role="alert">You've only filled out <%= 50 %>% of your tournament information! Finish adding details so your customers know what's up!</div>
	  </div>
	 </div>

	<div class="row">
		<div class="col-md-9">
			<h1> Organizer Dashboard </h1>
			<h3><%= @tournament.name %></h3>
		</div>
		<div class="col-md-3">
			<div class="pull-right" style="padding-top: 35px; padding-bottom: 35px;">
				<a href="#editModal" role="button" class="btn btn-primary" data-toggle="modal">Edit</a>
				<a href="#sponsorshipsModal" role="button" class="btn btn-primary" data-toggle="modal">Sponsorship</a>
				<a href=<%= tournament_url_with_privacy(@tournament) %>="button" class="btn btn-primary" data-toggle="modal">Go back</a>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-md-4">
			<p class="text-center">
					<strong>Details:</strong>
					<span class="pull-right">
						<i class="btn btn-xs glyphicon glyphicon-pencil" href="#editModal" data-toggle="modal"></i>
						<i class="btn btn-xs glyphicon glyphicon-trash" href="#deleteModal" data-toggle="modal"></i>
					</span>
			</p>
			<%= render(:partial => "info" ,:controller=>"tournament", :locals => {organize: @organize}) %>
		</div>
		<div class="col-md-4">
			<p class="text-center">
				<strong>Players</strong>
				<i href="#emailModal" role="button" class="btn btn-xs glyphicon glyphicon-envelope pull-right" data-toggle="modal"></i>
			</p>
			<table class="table table-striped">
					<% if @people.empty? %>
						<p class="text-center">Nobody has signed up yet!</p>
					<% else %>
			    	<% @people.each do |person| %>
				  			<tr>
				  				<td><%= person.fName + " " + person.lName %></td>
									<td>
										<span class="pull-right">
										  <i class="btn btn-xs glyphicon glyphicon-search" data-toggle="collapse" href=<%= "#details" + person.id.to_s %> aria-expanded="false" aria-controls=<%= "details" + person.id.to_s %>></i>
										</span>
									</td>
								</tr>
								<tr id=<%= "details" + person.id.to_s %> class="collapse">
									<td>
										<strong>Contact information:</strong><br>
										<%= person.email %> <br>
										<strong>Check-in status:</strong> <br>
										Unknown <br>
										<strong>Tools: </strong><br>
										<span class="btn-group btn-group-sm" role="group">
											<%= link_to "Resend Confirmation", {action: "resend_confirmation", person_id: person.id}, {role: 'button', class: 'btn btn-default'} %>
											<%= link_to "Refund", {action: "refund", person_id: person.id}, {role: 'button', class: 'btn btn-default'} %>
										</span>
									</td>
									<td>
									</td>
								</tr>
			    	<% end %>
			    <% end %>
			</table>
		</div>
		<div class="col-md-4">
				<p class="text-center">
					<strong>Sales Report</strong>
				</p>
				<table class="table table-striped">
					<tr>
						<td>Total Number of tickets</td>
						<td><%= @tournament.numGuests %></td>
					</tr>
					<tr>
						<td>Tickets Left</td>
						<td><%= @tournament.ticketsLeft %></td>
					</tr>
					<% @sales_by_ticket_types.each do |tt| %>
						<tr>
							<td><%= tt['type'] %> tickets sold</td>
							<td><%= tt['sales'] %></td>
						</tr>
					<% end %>
				</table>
		</div>
	</div>
<div class="col-md-4">
			<p class="text-center">
				<strong>Events and Features</strong>
			</p>
				<p>Build a schedule for your customers here. List all the fantastic stuff you're going to have at your tournament!</p>
				<strong>Schedule</strong>
				<p>
				<span class="">
				<i class="btn btn-xs glyphicon glyphicon-plus" href="#scheduledEventModal"  data-toggle="modal"></i>Add to the schedule
				</span></p>
				<p> Eg. Lunch at noon, Raffle draw at 3PM</p>
				<table class="table table-striped">
						<tr>
							<th>Time</th>
							<th>Event</th>
							<th></th>
						</tr>
						<% @sched_events.each do |se| %>
							<tr>
								<td>
									<%= se.startTime.strftime("%H:%M %p") %>
								</td>
								<td> <%= se.description %></td>
								<td><span class="pull-right">
								<%= link_to  [@tournament, se], remote: true, method: :delete do%>
    							<i class="btn btn-xs glyphicon glyphicon-trash"></i>
								<% end %>
							</span></td>
							</tr>
						<% end %>
				</table>
				<strong>Features</strong>
				<p>
				<span class="">
				<i class="btn btn-xs glyphicon glyphicon-plus" href="#featuredEventModal"  data-toggle="modal"></i>Add some fun features
				</span></p>
				<p> Eg. prizes for the longest drive winner... </p>
				<table class="table table-striped">
						<% @tournament.unscheduled_events.each do |ue| %>
							<tr>
								<td> <%= ue.description %></td>
								</td>
								<td><span class="pull-right">
								<%= link_to  [@tournament, ue], remote: true, method: :delete do%>
    							<i class="btn btn-xs glyphicon glyphicon-trash"></i>
								<% end %>
							</span></td>
							</tr>
						<% end %>
				</table>
		</div>


	<div class="row">
		<div class="col-md-4">
			<p class="text-center">
				<strong>Teams</strong>
			</p>
			<table class="table table-striped">
				<% if @teams.empty? %>
					<p class="text-center">No teams built yet!</p>
				<% else %>
					<tr>
						<th>Team ID</th>
						<th>Players</th>
						<th>Tee time</th>
						<th></th>
					</tr>
					<% @teams.each do |team| %>
						<tr>
							<td><%= team.id%></td>
							<td>
								<%= team.numPlayers %>
								<% if team.numPlayers == 4 %>
									<strong> (FULL)</strong>
								<% end %>
							</td>
							<td> <%= team.teeTime.strftime("%H:%M") %></td>
							</td>
						</tr>
					<% end %>
				<% end %>
			</table>
		</div>
	</div
		<div class="row">
		<div class="col-md-4">
			<p class="text-center">
				<strong>Organizers</strong>
			<% if @organizer_permissions %>
			<span class="pull-right">
				<i class="btn btn-xs glyphicon glyphicon-plus" href="#adminModal"  data-toggle="modal"></i>
				</span>
			<% end %></p>
			<table class="table table-striped">
				<% @admins.each do |admin| %>
					<tr>
						<td> <%= admin.person.fName + " " + admin.person.lName%></td>
						<td> <%= admin.permissions %></td>
						<td>
							<% if @organizer_permissions %>
							<span class="pull-right">
								<%= link_to 'Delete', :controller => 'organizer', :action => 'destroy', method:'delete', :id => admin.id do %>
									<i class="btn btn-xs glyphicon glyphicon-trash"></i>
								<% end %>
							</span>
							<% end %>
						</td>
					</tr>
				<% end %>
			</table>
		</div>


	</div>
